책임 할당 과정은 일종의 트레이드오프 활동

GRASP 패턴을 통해 트레이드오프 기준을 배울 수 있다

# 01 책임 주도 설계를 향해

## 데이터보다 행동을 먼저 결정하라

- “이 객체가 수행해야 할 책임은 무엇인가” → “수행하는데 필요한 데이터는 무엇인가”
    - 데이터는 재료일 뿐
- 책임(행동) 먼저 결정 → 상태 결정

## 협력이라는 문맥 안에서 책임을 결정하라

- 책임 할당을 위해서는 협력이라는 문맥 고려
    - 책임의 품질 = 협력에 적합한 정도 = 클라이언트의 의도에 적합한 책임
- 메시지가 객체를 선택
    - 객체의 존재 이유는 메시지를 전송해야 하기 때문
- 메세지 먼저 결정 → 객체 내부 고민
    - 메시지 송신자는 수신자를 고려하지 않아도 됨

## 책임 주도 설계

- 핵심은 책임 결정 → 수행할 객체 결정
- 협력에 참여하는 객체들이 어느 정도 정리되기 전에는 객체 내부 고려 X

# 02 책임 할당을 위한 GRASP 패턴

GRASP(General Responsibility Assignment Software Pattern, 일반적인 책임 할당을 위한 소프트웨어 패턴)

## 도메인 개념에서 출발하기

- 책임을 할당할 때 가장 먼저 고민할 유력한 후보는 도메인 개념
- 도메인을 그대로 투영한 모델 X 구현에 도움 되는 모델 O
    - 설계를 시작하는 것이 중요, 완벽한 도메인 개념 정리 X

## 정보 전문가에게 책임을 할당하라

INFORMATION EXPERT(정보 전문가) 패턴: 책임을 수행하는 데 필요한 정보를 가진 객체에게 할당하라

- ‘알고’있다 ≠ ‘저장’하고 있다
    - 예) 정보를 제공한 다른 객체를 알고 있을 수도 있다
- 정보를 알고 있는 객체가 책임을 어떻게 수행할지 스스로 결정 → 자율적인 객체

## 높은 응집도와 낮은 결합도

책임 할당의 다양한 대안이 존재한다면 응집도, 결합도 측면에서 선택

LOW COUPLING(낮은 결합도) 패턴: 결합도를 낮게 유지하라

- 새로운 결합이 추가되지 않는 방향으로

HIGH COHENSION(높은 응집도) 패턴: 높은 응집도 유지하라

- 서로 다른 이유로 변경되는 책임을 함께 짊어지게 하지 않기

## 창조자에게 객체 생성 책임을 할당하라

CREATOR(창조자) 패턴: 생성될 객체와 연결 or 관련될 필요가 있는 객체에게 해당 객체 생성 책임을 맡겨라

- 생성될 객체를 포함 또는 참조하는 객체
- 생성될 객체를 기록하는 객체
- 생성될 객체와 긴밀하게 협력하는 객체
- 생성될 객체의 초기화에 필요한 데이터를 아는 정보 전문가 객체

# 03 구현을 통한 검증

## DiscountCondition 개선하기

클래스 응집도 판단

- 클래스가 하나 이상의 이유로 변경된다
- 인스턴스 초기화 시 경우에 따라 서로 다른 속성을 초기화한다
- 사용하는 속성에 따라 메서드 그룹이 나뉜다

클래스 응집도 개선

- 변경의 이유에 따라 분리
- 함께 초기화되는 속성을 기준으로 분리
- 속성 그룹과 해당 그룹에 접근하는 메서드 그룹 기준으로 분리

## 타입 분리하기

위와 같은 원칙에 따라 타입을 분리한 후

- 클라이언트 객체가 두 타입과 결합하게 되어 오히려 결합도가 높아짐
- 새로운 타입을 추가하기 오히려 어려워짐

## 다형성을 통해 분리하기

사실 클라이언트 입장에서는 차이가 없다

- 동일한 책임, 즉 동일한 역할을 수행
- 역할 → 객체에 대한 추상화

POLYMORPHISM(다형성) 패턴: 객체의 암시적 유형에 따라 변하는 행동이 있다면 타입을 명시적으로 분리하고 변하는 행동을 각 타입의 책임으로 할당하라

## 변경으로부터 보호하기

PROTECTED VARIATIONS(변경 보호) 패턴: 변경이 예상되는 불안정한 부분을 캡슐화하라

- 예) 인터페이스 분리 → 구체 타입의 변경에 대한 캡슐화

## Movie 클래스 개선하기

- 변경 역시 도메인의 일부
    - 도메인 모델에는 도메인 안에서 변하는 개념과 관계가 투영되어야
- 구현을 가이드할 수 있는 도메인 모델을 선택하라

## 변경과 유연성

- 유연성은 의존성 관리의 문제
    - 유연성 정도에 따라 결합도를 조절할 수 있어야
- 도메인 모델은 구현과 밀접한 관계를 맺어야
    - 구현 가이드 + 구현 변화와 발맞춰 함께 변화

# 04 책임 주도 설계의 대안

리팩터링(Refactoring): 겉으로 보이는 동작 변경 없이 내부 구조 변경

- 적절한 책임 할당이 어렵다면 먼저 기능을 수행하는 코드를 최대한 빠르게 작성한 후 리팩터링하라
- 처음부터 책임 주도 설계 방법을 단계적으로 따르지 않아도 유연, 깔끔한 코드를 얻을 수 있다

## 메서드 응집도

- 몬스터 메서드(응집도 낮은 긴 메서드)를 응집도 있는 수준으로 분해
- 작게 나뉜 메서드 → 전체 흐름 이해하기 쉽고 변경하기 쉬워짐

## 객체를 자율적으로 만들자

- 나눠진 메서드가 어떤 데이터를 사용하는지에 따라 클래스 분리
